<div id="zoghal-game" oncontextmenu="return false;" style="direction:rtl; max-width:440px; margin:20px auto; background: radial-gradient(circle at center, #1a0000 0%, #050505 100%); border:3px solid #ff4d00; border-radius:30px; padding:15px; color:#fff; text-align:center; box-shadow:0 0 50px rgba(255,0,0,0.4); font-family:tahoma; position:relative; -webkit-user-select:none; user-select:none;">
    
    <h3 style="color:#ffae00; margin-bottom:10px; font-size:14px; text-shadow:0 0 15px #ff4d00;">ğŸ”¥ Ø¢Ø³ÙˆÙ†Ù‡ Ø­Ù„Ø´ Ú©Ù†  (Ø¬Ø§ÛŒØ²Ù‡: Û² Ú©ÛŒØ³Ù‡ Ø°ØºØ§Ù„) ğŸ”¥</h3>
    
    <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:12px; background:rgba(255,0,0,0.1); padding:10px; border-radius:15px; border:1px solid rgba(255,77,0,0.4);">
        <span>Ø²Ù…Ø§Ù†: <b id="tm" style="color:#ff4d00; font-size:20px;">40</b></span>
        <span id="game-status" style="color:#ffae00; font-weight:bold;"> Ø§ÙˆÙ„ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Øª Ø¨Ú¯ÛŒØ±Ù‡ğŸ˜‰ </span>
        <span>Ø§Ù…ØªÛŒØ§Ø²: <b id="sc" style="color:#e2b04a">1000</b></span>
    </div>

    <div id="grid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px;"></div>

    <div id="win-overlay" style="display:none; position:absolute; inset:0; background:rgba(0,0,0,0.97); z-index:200; flex-direction:column; align-items:center; justify-content:center; padding:20px; border-radius:25px;">
        <div id="win-msg" style="font-weight:900; font-size:16px; line-height:1.8; margin-bottom:15px;"></div>
        <div id="reward-area" style="display:none; width:100%;">
            <a id="wa-share" href="#" target="_blank" style="display:block; background:#25D366; color:#fff; text-decoration:none; padding:12px; border-radius:15px; font-weight:bold;">ğŸ“± Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø§ÛŒØ²Ù‡ Ø§Ø² ÙˆØ§ØªØ³â€ŒØ§Ù¾</a>
        </div>
        <button onclick="initGame()" style="margin-top:15px; background:#ff4d00; color:#fff; border:none; padding:10px 25px; border-radius:50px; cursor:pointer; font-weight:bold;">Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø´Ø§Ù†Ø³ ØªÙˆ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù† ğŸ”„</button>
    </div>
</div>

<style>
    .card { height:55px; cursor:pointer; perspective: 1000px; }
    .card-inner { position:relative; width:100%; height:100%; transition: transform 0.4s; transform-style: preserve-3d; pointer-events: none; }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-face { position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; font-size:9px; font-weight:bold; border-radius:8px; border:1px solid #333; padding:2px; overflow:hidden; }
    .card-back { background: #1a1a1a; color:#ff4d00; font-size:16px; }
    .card-front { background:#fff; transform:rotateY(180deg); color:#000; border: 2px solid #ff4d00; text-align:center; line-height:1; }
    .fire-match { animation: fire-glow 0.8s ease-out; border: 2px solid #ff4d00 !important; box-shadow: 0 0 20px #ffae00 inset !important; }
    @keyframes fire-glow { 0%{transform:scale(1);} 50%{transform:scale(1.15);box-shadow:0 0 30px #ff4d00;} 100%{transform:scale(1);} }
    .penalty-flash { animation: flash-red 0.5s; }
    @keyframes flash-red { 0% {background:transparent;} 50% {background:rgba(255,0,0,0.4);} 100% {background:transparent;} }
    .shake { animation: s 0.3s; }
    @keyframes s { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
</style>

<script>
(function() {
    const locations = ['Ø§Ø´Ú©ÙØª Ø³Ù„Ù…Ø§Ù†','Ú©ÙˆÙ„ÙØ±Ø­','Ø³ÙˆØ³Ù†','Ø¯Ù‡Ø¯Ø²','Ø­Ø§ÙØ¸ Ø¬Ù†ÙˆØ¨ÛŒ','Ø³Ù„Ù…Ø§Ù† ÙØ§Ø±Ø³ÛŒ','Ø­Ø§ÙØ¸ Ø´Ù…Ø§Ù„ÛŒ','ÙÙ„Ú©Ù‡ Ø§ØµÙ„ÛŒ','ÙÙ„Ú©Ù‡ Ø¹Ù„ÛŒ','Ø³Ø±Ù‚Ù†Ø§Øª','Ø§ÛŒØ°Ù‡','Ø¨Ø§Ø²Ø§Ø±Ø³Ø¨Ø²ÛŒ','Ù…Ù†Ù‚Ù„','Ú©Ø¨Ø§Ø¨','Ú©Ø¨Ø±ÛŒØª','Ø°ØºØ§Ù„'];
    let gameData=[], flipped=[], matched=0, score=1000, time=40, lock=true, timer, musicInterval;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSnd(f, d, type='triangle', v=0.5) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(f, audioCtx.currentTime);
        gain.gain.setValueAtTime(v, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + d);
    }

    function startPanicMusic() {
        if(musicInterval) clearTimeout(musicInterval);
        const playTick = () => {
            // Ù…Ù„ÙˆØ¯ÛŒ Ø§Ø³ØªØ±Ø³ Ù‚ÙˆÛŒâ€ŒØªØ± (Ø¯Ùˆ Ø¶Ø±Ø¨Ù‡â€ŒØ§ÛŒ ØªÙ‡Ø§Ø¬Ù…ÛŒ)
            playSnd(90, 0.2, 'square', 0.7); 
            setTimeout(() => playSnd(140, 0.1, 'sawtooth', 0.3), 150); 
            
            // Ø³Ø±Ø¹Øª Ù…Ù„ÙˆØ¯ÛŒ Ø¨Ø§ Ú¯Ø°Ø´Øª Ø²Ù…Ø§Ù† ÙˆØ­Ø´ØªÙ†Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯
            let tempo = time > 25 ? 900 : (time > 10 ? 450 : 200); 
            if(time > 0 && matched < locations.length) {
                musicInterval = setTimeout(playTick, tempo);
            }
        };
        playTick();
    }

    window.initGame = () => {
        clearInterval(timer);
        clearTimeout(musicInterval);
        score=1000; time=40; matched=0; flipped=[]; lock=true;
        document.getElementById('win-overlay').style.display = 'none';
        document.getElementById('reward-area').style.display = 'none';
        
        let fullList = [...locations, ...locations];
        fullList.sort(() => Math.random() - 0.5);
        gameData = fullList;

        const grid = document.getElementById('grid');
        grid.innerHTML = gameData.map((_, i) => `
            <div class="card flipped" id="c-${i}" onclick="flip(this,${i})">
                <div class="card-inner">
                    <div class="card-face card-back">ØŸ</div>
                    <div class="card-face card-front">${gameData[i]}</div>
                </div>
            </div>`).join('');

        setTimeout(() => {
            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('flipped');
                c.querySelector('.card-inner').style.pointerEvents = 'auto';
            });
            lock = false;
            startTimer();
            startPanicMusic();
        }, 1500);
    };

    function startTimer() {
        timer = setInterval(() => { 
            time--; 
            if(time <= 0) { time=0; end(false); }
            document.getElementById('tm').innerText = time;
            document.getElementById('sc').innerText = score;
        }, 1000);
    }

    window.flip = (el, idx) => {
        if(lock || el.classList.contains('flipped') || flipped.some(f => f.el === el)) return;
        el.classList.add('flipped');
        flipped.push({el, e: gameData[idx]});
        
        if(flipped.length === 2) {
            lock = true;
            if(flipped[0].e === flipped[1].e) {
                matched++; score += 150;
                playSnd(250, 0.7, 'sawtooth', 0.2); // ØµØ¯Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª (Ø´Ø¹Ù„Ù‡)
                flipped.forEach(f => f.el.querySelector('.card-front').classList.add('fire-match'));
                flipped=[]; lock=false;
                if(matched === locations.length) end(true);
            } else {
                score = Math.max(0, score - 100);
                time = Math.max(0, time - 3); // Ø¬Ø±ÛŒÙ…Ù‡ Ø³Ù†Ú¯ÛŒÙ† Û³ Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ
                document.getElementById('zoghal-game').classList.add('penalty-flash');
                setTimeout(() => document.getElementById('zoghal-game').classList.remove('penalty-flash'), 500);
                playSnd(40, 0.5, 'square', 0.3); // ØµØ¯Ø§ÛŒ Ø®Ø·Ø§ÛŒ ØªØ±Ø³Ù†Ø§Ú©
                setTimeout(() => {
                    flipped.forEach(f => f.el.classList.add('shake'));
                    setTimeout(() => {
                        flipped.forEach(f => f.el.classList.remove('flipped','shake'));
                        flipped=[]; lock=false;
                    }, 350);
                }, 400);
            }
        }
    };

    const end = (win) => {
        clearInterval(timer);
        clearTimeout(musicInterval);
        document.getElementById('win-overlay').style.display = 'flex';
        if(win) {
            document.getElementById('win-msg').innerHTML = "ğŸ† Ø´Ø§Ù‡Ú©Ø§Ø± Ú©Ø±Ø¯ÛŒ! Ø§ÛŒØ°Ù‡ Ø¨Ù‡Øª Ø§ÙØªØ®Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡.<br>Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: " + score;
            document.getElementById('reward-area').style.display = 'block';
            const txt = encodeURIComponent(`Ø³Ù„Ø§Ù…! Ù…Ù† Ú†Ø§Ù„Ø´ ÙÙˆÙ‚â€ŒØ³Ø®Øª Û³Û² Ú©Ø§Ø±ØªÛŒ Ø±Ùˆ Ø¨Ø±Ø¯Ù…. Ø¬Ø§ÛŒØ²Ù‡ Û² Ú©ÛŒØ³Ù‡ Ø°ØºØ§Ù„ Ù…Ù† Ø±Ùˆ Ø¨ÙØ±Ø³ØªÛŒØ¯! ğŸ”¥`);
            document.getElementById('wa-share').href = `https://wa.me/989220730628?text=${txt}`;
        } else {
            document.getElementById('win-msg').innerText = "Ø§Ø´ØªØ¨Ø§Ù‡Ø§ØªØª Ø²ÛŒØ§Ø¯ Ø¨ÙˆØ¯ Ùˆ ÙˆÙ‚ØªØª ØªÙ…ÙˆÙ… Ø´Ø¯!. ğŸ¢";
        }
    };

    initGame();
})();
</script>
